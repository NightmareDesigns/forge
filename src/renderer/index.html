<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' http://localhost:*; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:">
  <title>Nightmare Designs Forge</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="logo.css">
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Logo Header -->
    <header id="app-header">
      <div class="logo-container logo-compact">
        <span class="nightmare-logo glow">Nightmare Designs Forge</span>
        <div class="blood-drips">
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
          <div class="drip"></div>
        </div>
      </div>
      <div class="header-spacer"></div>
      <button id="toggle-right-panel" class="tool-btn" title="Properties" style="margin-right:8px">‚ò∞</button>
      <a href="https://nightmaredesigns.org" target="_blank" class="header-link">nightmaredesigns.org</a>
    </header>

    <!-- Left Toolbar (Scrollable) -->
    <aside id="toolbar">
      <div class="tool-group">
        <button class="tool-btn" id="toggle-panel" title="Drawing Tools & Options">
          <span class="icon">üõ†</span>
        </button>
      </div>
      <div class="tool-group">
        <button class="tool-btn active" data-tool="select" title="Select (V)">
          <span class="icon">‚¨ö</span>
        </button>
        <button class="tool-btn" data-tool="node" title="Node Editor (A)">
          <span class="icon">‚óà</span>
        </button>
      </div>

      <div class="tool-group">
        <button class="tool-btn" data-tool="pen" title="Pen Tool (P)">
          <span class="icon">‚úí</span>
        </button>
        <button class="tool-btn" data-tool="freehand" title="Freehand (F)">
          <span class="icon">‚úè</span>
        </button>
        <button class="tool-btn" data-tool="eraser" title="Eraser (E)">
          <span class="icon">üßπ</span>
        </button>
      </div>

      <div class="tool-group">
        <button class="tool-btn" data-tool="text" title="Text (T)">
          <span class="icon">T</span>
        </button>
        <button class="tool-btn" data-tool="image" title="Upload Image">
          <span class="icon">üñº</span>
        </button>
      </div>

      <div class="tool-group">
        <button class="tool-btn" data-tool="trace" title="Image Trace">
          <span class="icon">‚ä°</span>
        </button>
        <button class="tool-btn" data-tool="color-picker" title="Color Picker (X)">
          <span class="icon">üé®</span>
        </button>
      </div>
    </aside>

    <!-- Slide-Out Tool Panel -->
    <div id="tool-panel" class="tool-panel">
      <div class="panel-header">
        <h3>Tools & AI</h3>
        <button id="close-panel" class="close-btn">√ó</button>
      </div>
      <div class="panel-content">
        <!-- Image Import Section -->
        <div class="panel-section">
          <h4>Import & Trace</h4>
          <div class="tool-row">
            <button id="import-image-btn" class="tool-btn-panel" style="background: #6c5ce7; width: 100%">üìÅ Import Image</button>
          </div>
          <div class="tool-row">
            <button id="trace-image-btn" class="tool-btn-panel" style="background: #a29bfe; width: 100%">‚ú® Trace to SVG</button>
          </div>
          <input type="file" id="image-input" accept="image/*" style="display: none;">
        </div>

        <div class="tool-divider"></div>

        <!-- Drawing Tools Section -->
        <div class="panel-section">
          <h4>Drawing Tools</h4>
          <div class="tool-row">
            <label>Brush Size</label>
            <input type="range" id="brush-size" min="1" max="20" value="3">
            <span id="brush-size-val">3</span>
          </div>
          <div class="tool-row">
            <label>Brush Opacity</label>
            <input type="range" id="brush-opacity" min="0.1" max="1" step="0.1" value="1">
            <span id="brush-opacity-val">100%</span>
          </div>
          <div class="tool-row">
            <label>Eraser Size</label>
            <input type="range" id="eraser-size" min="5" max="50" value="10">
            <span id="eraser-size-val">10</span>
          </div>
          <div class="tool-row">
            <button class="tool-quick" data-tool="brush" style="background: #4a90e2">Brush</button>
          </div>
          <div class="tool-row">
            <button class="tool-quick" data-tool="marker" style="background: #f5a623">Marker</button>
          </div>
          <div class="tool-row">
            <button class="tool-quick" data-tool="eraser" style="background: #999">Eraser</button>
          </div>
          <div class="tool-row">
            <button class="tool-quick" data-tool="pen" style="background: #7ed321">Pen</button>
          </div>
          <div class="tool-row">
            <button class="tool-quick" data-tool="color-picker" style="background: #ff6b6b">Color Picker</button>
          </div>
        </div>

        <div class="tool-divider"></div>

        <!-- AI Search Section -->
        <div class="panel-section">
          <h4>AI Design Search</h4>
          <div class="tool-row">
            <input type="text" id="ai-search-input" placeholder="Search designs..." class="ai-input">
          </div>
          <div class="tool-row">
            <button id="ai-search-btn" class="tool-btn-panel" style="background: #00b894; width: 100%">üîç Search</button>
          </div>
          <div class="tool-row">
            <input type="text" id="ai-generate-input" placeholder="Generate from prompt..." class="ai-input">
          </div>
          <div class="tool-row">
            <button id="ai-generate-btn" class="tool-btn-panel" style="background: #fd79a8; width: 100%">üé® Generate</button>
          </div>
          <div id="ai-status" class="ai-status" style="display: none;"></div>
        </div>
      </div>
    </div>

    <!-- Main Canvas Area -->
    <main id="canvas-container">
      <div id="rulers">
        <div id="ruler-horizontal"></div>
        <div id="ruler-vertical"></div>
      </div>
      <div id="canvas-wrapper">
        <canvas id="design-canvas"></canvas>
      </div>
      <div id="zoom-controls">
        <button id="zoom-out">‚àí</button>
        <span id="zoom-level">100%</span>
        <button id="zoom-in">+</button>
      </div>
    </main>

    <!-- Right Panel -->
    <aside id="properties-panel">
      <div class="panel-section">
        <h3>Layers</h3>
        <div id="layers-list">
          <div class="layer-item active">
            <span class="layer-visibility">üëÅ</span>
            <span class="layer-name">Layer 1</span>
            <span class="layer-lock">üîì</span>
          </div>
        </div>
        <div class="layer-controls">
          <button id="add-layer" title="Add Layer">+</button>
          <button id="delete-layer" title="Delete Layer">‚àí</button>
        </div>
      </div>

      <div class="panel-section">
        <h3>Transform</h3>
        <div class="property-row">
          <label>X:</label>
          <input type="number" id="prop-x" value="0">
          <label>Y:</label>
          <input type="number" id="prop-y" value="0">
        </div>
        <div class="property-row">
          <label>W:</label>
          <input type="number" id="prop-width" value="0">
          <label>H:</label>
          <input type="number" id="prop-height" value="0">
        </div>
        <div class="property-row">
          <label>Rotation:</label>
          <input type="number" id="prop-rotation" value="0">
          <span>¬∞</span>
        </div>
      </div>

      <div class="panel-section">
        <h3>Fill & Stroke</h3>
        <div class="property-row">
          <label>Fill:</label>
          <input type="color" id="prop-fill" value="#3498db">
          <button id="no-fill">‚àÖ</button>
        </div>
        <div class="property-row">
          <label>Stroke:</label>
          <input type="color" id="prop-stroke" value="#000000">
          <input type="number" id="stroke-width" value="1" min="0" step="0.5">
        </div>
      </div>

      <div class="panel-section">
        <h3>Operations</h3>
        <div class="operation-buttons">
          <button class="op-btn" data-op="weld" title="Weld shapes together">Weld</button>
          <button class="op-btn" data-op="slice" title="Slice shapes">Slice</button>
          <button class="op-btn" data-op="attach" title="Attach shapes">Attach</button>
          <button class="op-btn" data-op="flatten" title="Flatten to print">Flatten</button>
          <button class="op-btn" data-op="contour" title="Add contour">Contour</button>
          <button class="op-btn" data-op="offset" title="Offset path">Offset</button>
        </div>
      </div>

      <div class="panel-section">
        <h3>Cut Settings</h3>
        <div class="property-row">
          <label>Material:</label>
          <select id="material-select">
            <option value="vinyl">Vinyl</option>
            <option value="cardstock">Cardstock</option>
            <option value="cardstock-heavy">Heavy Cardstock</option>
            <option value="paper">Paper</option>
            <option value="iron-on">Iron-On</option>
            <option value="fabric">Fabric</option>
            <option value="faux-leather">Faux Leather</option>
            <option value="sticker-paper">Sticker Paper</option>
            <option value="vellum">Vellum</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="property-row">
          <label>Pressure:</label>
          <input type="range" id="cut-pressure" min="1" max="10" value="5">
          <span id="pressure-value">5</span>
        </div>
        <div class="property-row">
          <label>Speed:</label>
          <input type="range" id="cut-speed" min="1" max="10" value="4">
          <span id="speed-value">4</span>
        </div>
        <div class="property-row">
          <label>Multi-Cut:</label>
          <input type="number" id="multi-cut" min="1" max="5" value="1">
        </div>
      </div>

      <div class="panel-section">
        <h3>Device</h3>
        <div id="device-status" class="device-status disconnected">
          <span class="status-indicator"></span>
          <span id="device-name">No device connected</span>
        </div>
        <div class="device-controls">
          <button id="scan-devices-btn" class="device-btn">Scan</button>
          <button id="connect-device-btn" class="device-btn" disabled>Connect</button>
        </div>
        <select id="device-list" class="device-select" style="display: none;">
          <option value="">Select a device...</option>
        </select>
        <button id="send-cut-btn" class="send-cut-btn" disabled>Send to Cutter</button>
        <div id="cut-progress" class="cut-progress" style="display: none;">
          <div class="progress-bar"><div class="progress-fill"></div></div>
          <span class="progress-text">0%</span>
        </div>
      </div>
    </aside>

    <!-- Right Slide-Out Drawer (All Tools) -->
    <div id="right-drawer" class="right-drawer" aria-hidden="true">
      <div class="right-drawer-header">
        <h3>Tools & Settings</h3>
        <button id="close-right-drawer" class="close-btn">√ó</button>
      </div>
      <div id="right-drawer-content" class="right-drawer-content">
        <!-- Shape Tools -->
        <div class="drawer-section">
          <h4>Shapes</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="rectangle" title="Rectangle (R)">
              <span class="icon">‚ñ≠</span><span class="label">Rectangle</span>
            </button>
            <button class="tool-btn-grid" data-tool="circle" title="Circle (C)">
              <span class="icon">‚óØ</span><span class="label">Circle</span>
            </button>
            <button class="tool-btn-grid" data-tool="polygon" title="Polygon">
              <span class="icon">‚¨°</span><span class="label">Polygon</span>
            </button>
            <button class="tool-btn-grid" data-tool="star" title="Star">
              <span class="icon">‚òÖ</span><span class="label">Star</span>
            </button>
            <button class="tool-btn-grid" data-tool="line" title="Line (L)">
              <span class="icon">‚ï±</span><span class="label">Line</span>
            </button>
          </div>
        </div>

        <!-- Edit Tools -->
        <div class="drawer-section">
          <h4>Edit</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="duplicate" title="Duplicate (Ctrl+D)">
              <span class="icon">‚äï</span><span class="label">Duplicate</span>
            </button>
            <button class="tool-btn-grid" data-tool="group" title="Group (Ctrl+G)">
              <span class="icon">‚äû</span><span class="label">Group</span>
            </button>
            <button class="tool-btn-grid" data-tool="ungroup" title="Ungroup (Ctrl+Shift+G)">
              <span class="icon">‚äü</span><span class="label">Ungroup</span>
            </button>
            <button class="tool-btn-grid" data-tool="flip-h" title="Flip Horizontal">
              <span class="icon">‚áÑ</span><span class="label">Flip H</span>
            </button>
            <button class="tool-btn-grid" data-tool="flip-v" title="Flip Vertical">
              <span class="icon">‚áÖ</span><span class="label">Flip V</span>
            </button>
            <button class="tool-btn-grid" data-tool="rotate-90" title="Rotate 90¬∞">
              <span class="icon">‚Üª</span><span class="label">Rotate 90¬∞</span>
            </button>
          </div>
        </div>

        <!-- Alignment Tools -->
        <div class="drawer-section">
          <h4>Alignment</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="align-left" title="Align Left">
              <span class="icon">‚´∑</span><span class="label">Left</span>
            </button>
            <button class="tool-btn-grid" data-tool="align-center" title="Align Center">
              <span class="icon">‚´º</span><span class="label">Center</span>
            </button>
            <button class="tool-btn-grid" data-tool="align-right" title="Align Right">
              <span class="icon">‚´∏</span><span class="label">Right</span>
            </button>
            <button class="tool-btn-grid" data-tool="offset" title="Offset Path">
              <span class="icon">‚äö</span><span class="label">Offset</span>
            </button>
            <button class="tool-btn-grid" data-tool="contour" title="Contour">
              <span class="icon">‚óé</span><span class="label">Contour</span>
            </button>
          </div>
        </div>

        <!-- Path Operations -->
        <div class="drawer-section">
          <h4>Path Operations</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="bezier-editor" title="Bezier Curve Editor">
              <span class="icon">‚úé</span><span class="label">Bezier</span>
            </button>
            <button class="tool-btn-grid" data-tool="path-simplify" title="Simplify Path">
              <span class="icon">‚åÑ</span><span class="label">Simplify</span>
            </button>
            <button class="tool-btn-grid" data-tool="path-union" title="Union Paths">
              <span class="icon">‚äî</span><span class="label">Union</span>
            </button>
            <button class="tool-btn-grid" data-tool="path-subtract" title="Subtract Paths">
              <span class="icon">‚äñ</span><span class="label">Subtract</span>
            </button>
            <button class="tool-btn-grid" data-tool="path-intersect" title="Intersect Paths">
              <span class="icon">‚à©</span><span class="label">Intersect</span>
            </button>
            <button class="tool-btn-grid" data-tool="create-outline" title="Create Outline">
              <span class="icon">‚óª</span><span class="label">Outline</span>
            </button>
            <button class="tool-btn-grid" data-tool="merge-paths" title="Merge Paths">
              <span class="icon">‚ü∑</span><span class="label">Merge</span>
            </button>
            <button class="tool-btn-grid" data-tool="break-apart" title="Break Apart">
              <span class="icon">‚úï</span><span class="label">Break Apart</span>
            </button>
          </div>
        </div>

        <!-- Text Tools -->
        <div class="drawer-section">
          <h4>Text Tools</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="font-manager" title="Font Manager">
              <span class="icon">üî§</span><span class="label">Fonts</span>
            </button>
            <button class="tool-btn-grid" data-tool="text-on-path" title="Text on Path">
              <span class="icon">‚Ü∑</span><span class="label">On Path</span>
            </button>
            <button class="tool-btn-grid" data-tool="text-to-path" title="Text to Path">
              <span class="icon">‚àã</span><span class="label">To Path</span>
            </button>
            <button class="tool-btn-grid" data-tool="font-style" title="Font Styling">
              <span class="icon">ùêÄ</span><span class="label">Styling</span>
            </button>
            <button class="tool-btn-grid" data-tool="letter-spacing" title="Letter Spacing">
              <span class="icon">‚Üî</span><span class="label">Spacing</span>
            </button>
            <button class="tool-btn-grid" data-tool="text-overflow" title="Text Overflow">
              <span class="icon">‚äü</span><span class="label">Overflow</span>
            </button>
          </div>
        </div>

        <!-- Transform Tools -->
        <div class="drawer-section">
          <h4>Transform</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="skew" title="Skew/Shear">
              <span class="icon">‚´∑‚´∏</span><span class="label">Skew</span>
            </button>
            <button class="tool-btn-grid" data-tool="perspective" title="Perspective Transform">
              <span class="icon">‚ñ®</span><span class="label">Perspective</span>
            </button>
            <button class="tool-btn-grid" data-tool="mirror-advanced" title="Mirror Advanced">
              <span class="icon">‚ü∑</span><span class="label">Mirror</span>
            </button>
            <button class="tool-btn-grid" data-tool="scale-constrain" title="Scale with Constraints">
              <span class="icon">‚Üî‚Üï</span><span class="label">Scale</span>
            </button>
            <button class="tool-btn-grid" data-tool="stretch" title="Stretch & Squeeze">
              <span class="icon">‚óä</span><span class="label">Stretch</span>
            </button>
            <button class="tool-btn-grid" data-tool="3d-rotation" title="3D Rotation Preview">
              <span class="icon">‚Ü∫</span><span class="label">3D</span>
            </button>
            <button class="tool-btn-grid" data-tool="corner-adjust" title="Corner Adjustment">
              <span class="icon">‚®≠</span><span class="label">Corners</span>
            </button>
          </div>
        </div>

        <!-- Color & Fill -->
        <div class="drawer-section">
          <h4>Color & Fill</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="gradient-editor" title="Gradient Editor">
              <span class="icon">‚ñ§</span><span class="label">Gradient</span>
            </button>
            <button class="tool-btn-grid" data-tool="pattern-fill" title="Pattern Fill Creator">
              <span class="icon">‚ñ¶</span><span class="label">Pattern</span>
            </button>
            <button class="tool-btn-grid" data-tool="color-harmony" title="Color Harmonies">
              <span class="icon">‚óâ</span><span class="label">Harmony</span>
            </button>
            <button class="tool-btn-grid" data-tool="opacity" title="Opacity/Alpha Channel">
              <span class="icon">‚óé</span><span class="label">Opacity</span>
            </button>
            <button class="tool-btn-grid" data-tool="cmyk-separation" title="Color Separation">
              <span class="icon">‚äô</span><span class="label">CMYK Sep</span>
            </button>
          </div>
        </div>

        <!-- Selection Tools -->
        <div class="drawer-section">
          <h4>Advanced Selection</h4>
          <div class="tool-grid">
            <button class="tool-btn-grid" data-tool="select-color" title="Select by Color">
              <span class="icon">üé®</span><span class="label">By Color</span>
            </button>
            <button class="tool-btn-grid" data-tool="select-size" title="Select by Size">
              <span class="icon">üìè</span><span class="label">By Size</span>
            </button>
            <button class="tool-btn-grid" data-tool="select-similar" title="Select Similar">
              <span class="icon">‚âà</span><span class="label">Similar</span>
            </button>
            <button class="tool-btn-grid" data-tool="select-inverse" title="Select Inverse">
              <span class="icon">‚äò</span><span class="label">Inverse</span>
            </button>
          </div>
        </div>

        <!-- Divider -->
        <hr style="border: none; border-top: 1px solid #333; margin: 20px 0;">

        <!-- Quick Properties -->
        <div class="drawer-section">
          <h4>Quick Properties</h4>
          <div class="property-quick">
            <p style="color: #888; font-size: 12px; margin: 10px 0;">Select an object to edit properties</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Trace Dialog -->
  <div id="trace-dialog" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Image Trace</h2>
        <button class="modal-close" id="close-trace-dialog">√ó</button>
      </div>
      <div class="modal-body">
        <div class="trace-preview">
          <div class="preview-original">
            <h4>Original</h4>
            <img id="trace-original" src="" alt="Original image">
          </div>
          <div class="preview-result">
            <h4>Traced</h4>
            <div id="trace-result"></div>
          </div>
        </div>
        <div class="trace-options">
          <div class="option-row">
            <label>Mode:</label>
            <select id="trace-mode">
              <option value="simple">Simple (Black/White)</option>
              <option value="posterize">Posterize (Multi-color)</option>
            </select>
          </div>
          <div class="option-row">
            <label>Threshold:</label>
            <input type="range" id="trace-threshold" min="0" max="255" value="128">
            <span id="threshold-value">128</span>
          </div>
          <div class="option-row" id="posterize-steps-row" style="display: none;">
            <label>Color Steps:</label>
            <input type="number" id="posterize-steps" min="2" max="8" value="4">
          </div>
          <div class="option-row">
            <label>Detail:</label>
            <select id="trace-detail">
              <option value="high">High</option>
              <option value="medium" selected>Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="option-row">
            <label><input type="checkbox" id="trace-invert"> Invert</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="trace-preview-btn" class="btn">Preview</button>
        <button id="trace-apply-btn" class="btn btn-primary">Apply</button>
      </div>
    </div>
  </div>

  <!-- Bottom Status Bar -->
  <footer id="status-bar">
    <span id="status-message">Ready</span>
    <span id="canvas-size">12" √ó 12"</span>
    <span id="selected-count">0 objects selected</span>
  </footer>

  <script src="license-ui.js"></script>
  <script src="app.js"></script>
</body>
</html>
